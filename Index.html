<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quick Link</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      .container {
        display: flex;
        height: 100vh;
      }

      .left {
        width: 80%;
        padding: 20px;
        overflow-y: auto;
      }

      .right {
        width: 50%;
        background-color: #f4f4f4;
        padding: 20px;
        font-size: 18px;
      }

      table {
        width: 90%;
        border-collapse: collapse;
        margin: 10px auto;
      }

      th,
      td {
        border: 1px solid black;
        padding: 10px;
        text-align: center;
      }

      th {
        background-color: #f4f4f4;
        cursor: pointer;
      }

      button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 8px 12px;
        cursor: pointer;
        border-radius: 5px;
      }

      button:hover {
        background-color: #0056b3;
      }

      .form-container {
        margin-top: 20px;
        text-align: center;
      }

      select,
      input[type="text"],
      input[type="url"] {
        margin: 5px;
        padding: 8px;
        width: 200px;
      }

      .form-container button {
        margin-left: 10px;
      }

      .add-table-container {
        margin-top: 20px;
        text-align: center;
      }

      .delete-table-button {
        margin-top: 10px;
      }

      .status-message {
        margin-top: 20px;
        padding: 10px;
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        border-radius: 5px;
        text-align: center;
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- ด้านซ้าย -->
      <div class="left">
        <h2 style="text-align: center">Link Management</h2>
        <div id="tables-container"></div>
      </div>

      <!-- ด้านขวา -->
      <div class="right">
        <h2>จัดการลิงก์และตาราง</h2>

        <!-- Form for adding/deleting links and tables -->
        <div class="form-container">
          <h3>เพิ่ม/ลบ ลิงก์</h3>
          <select id="tableSelect"></select>
          <input type="text" id="linkName" placeholder="ชื่อลิงก์" />
          <input type="url" id="linkURL" placeholder="URL" />
          <button onclick="addLink()">เพิ่มลิงก์</button>
          <button onclick="deleteLink()">ลบลิงก์</button>

          <h3>เพิ่ม/ลบ ตาราง</h3>
          <input type="text" id="newTableName" placeholder="ชื่อตารางใหม่" />
          <button onclick="addTable()">เพิ่มตาราง</button>

          <div class="delete-table-container">
            <select id="tableDeleteSelect"></select>
            <button class="delete-table-button" onclick="deleteTable()">
              ลบตาราง
            </button>
          </div>
        </div>

        <!-- สถานะ -->
        <div class="status-message" id="statusMessage"></div>
      </div>
    </div>

    <script>
      window.onload = function () {
        // ดึงข้อมูลตารางและลิงก์จาก localStorage
        const tables = JSON.parse(localStorage.getItem("tables")) || [];
        const links = JSON.parse(localStorage.getItem("links")) || {};

        // แสดงตารางที่เก็บไว้ใน localStorage
        tables.forEach((tableName) => {
          createTable(tableName, links[tableName] || []);
        });

        // อัพเดตตัวเลือกใน select
        updateTableSelect();
      };

      function createTable(tableName, links) {
        const leftSection = document.querySelector(".left");

        // สร้างชื่อหัวตาราง
        const newTableHeading = document.createElement("h2");
        newTableHeading.textContent = tableName;
        leftSection.appendChild(newTableHeading);

        // สร้างตาราง
        const newTable = document.createElement("table");
        newTable.id = tableName;
        newTable.innerHTML = `
          <thead>
              <tr>
                  <th onclick="sortTable('${tableName}')">Name ⬍</th>
                  <th>Link</th>
              </tr>
          </thead>
          <tbody>
            ${links
              .map(
                (link) =>
                  `<tr><td>${link.name}</td><td><button onclick="window.open('${link.url}', '_blank')">Click</button></td></tr>`
              )
              .join("")}
          </tbody>
        `;
        leftSection.appendChild(newTable);
      }

      function updateTableSelect() {
        const select = document.getElementById("tableSelect");
        const tableDeleteSelect = document.getElementById("tableDeleteSelect");

        // ดึงข้อมูลตารางจาก localStorage
        const tables = JSON.parse(localStorage.getItem("tables")) || [];

        // อัพเดตตัวเลือกใน select สำหรับการเลือกตาราง
        select.innerHTML = "";
        tableDeleteSelect.innerHTML = "";
        tables.forEach((tableName) => {
          const option = document.createElement("option");
          option.value = tableName;
          option.textContent = tableName;
          select.appendChild(option);

          const deleteOption = document.createElement("option");
          deleteOption.value = tableName;
          deleteOption.textContent = tableName;
          tableDeleteSelect.appendChild(deleteOption);
        });
      }

      function sortTable(tableId) {
        const table = document.getElementById(tableId);
        const tbody = table.querySelector("tbody");
        const rows = Array.from(tbody.querySelectorAll("tr"));

        let ascending = table.dataset.ascending === "true";

        rows.sort((rowA, rowB) => {
          const nameA = rowA.cells[0].textContent.trim().toLowerCase();
          const nameB = rowB.cells[0].textContent.trim().toLowerCase();
          return ascending
            ? nameA.localeCompare(nameB)
            : nameB.localeCompare(nameA);
        });

        tbody.innerHTML = "";
        rows.forEach((row) => tbody.appendChild(row));

        table.dataset.ascending = !ascending;
        const th = table.querySelector("th");
        th.textContent = ascending ? "Name ⬆️" : "Name ⬇️";
      }

      function addLink() {
        const tableId = document.getElementById("tableSelect").value;
        const table = document.getElementById(tableId);
        const linkName = document.getElementById("linkName").value;
        const linkURL = document.getElementById("linkURL").value;

        if (linkName && linkURL) {
          const fullURL = linkURL.startsWith("http")
            ? linkURL
            : "http://" + linkURL;

          const newRow = table.querySelector("tbody").insertRow();
          newRow.innerHTML = `
            <td>${linkName}</td>
            <td><button onclick="window.open('${fullURL}', '_blank')">Click</button></td>
          `;

          // เก็บลิงก์ลงใน localStorage
          let links = JSON.parse(localStorage.getItem("links")) || {};
          if (!links[tableId]) {
            links[tableId] = [];
          }
          links[tableId].push({ name: linkName, url: fullURL });
          localStorage.setItem("links", JSON.stringify(links));

          showStatusMessage(`ลิงก์ '${linkName}' ถูกเพิ่มแล้ว`);
        } else {
          showStatusMessage("กรุณากรอกชื่อและ URL ของลิงก์");
        }
      }

      function deleteLink() {
        const tableId = document.getElementById("tableSelect").value;
        const table = document.getElementById(tableId);
        const linkName = document.getElementById("linkName").value;

        const row = [...table.rows].find(
          (row) => row.cells[0].textContent === linkName
        );

        if (row) {
          // ถามยืนยันจากผู้ใช้
          const confirmDelete = window.confirm(
            `คุณแน่ใจที่จะลบลิงก์ '${linkName}'?`
          );
          if (confirmDelete) {
            row.remove();
            showStatusMessage(`ลิงก์ '${linkName}' ถูกลบแล้ว`);

            // ลบลิงก์ออกจาก localStorage
            let links = JSON.parse(localStorage.getItem("links")) || {};
            links[tableId] = links[tableId].filter(
              (link) => link.name !== linkName
            );
            localStorage.setItem("links", JSON.stringify(links));
          } else {
            showStatusMessage("การลบลิงก์ถูกยกเลิก");
          }
        } else {
          showStatusMessage("ไม่พบลิงก์ที่ต้องการลบ");
        }
      }

      function addTable() {
        const tableName = document.getElementById("newTableName").value;

        if (tableName) {
          // ถามยืนยันจากผู้ใช้
          const confirmAddTable = window.confirm(
            `คุณแน่ใจที่จะเพิ่มตารางชื่อ '${tableName}'?`
          );
          if (confirmAddTable) {
            const newTable = document.createElement("table");
            newTable.id = tableName;
            newTable.innerHTML = `
              <thead>
                  <tr>
                      <th onclick="sortTable('${tableName}')">Name ⬍</th>
                      <th>Link</th>
                  </tr>
              </thead>
              <tbody></tbody>
            `;

            const leftSection = document.querySelector(".left");
            const newTableHeading = document.createElement("h2");
            newTableHeading.textContent = tableName;
            leftSection.appendChild(newTableHeading);
            leftSection.appendChild(newTable);

            // เก็บตารางลงใน localStorage
            let tables = JSON.parse(localStorage.getItem("tables")) || [];
            tables.push(tableName);
            localStorage.setItem("tables", JSON.stringify(tables));

            // อัพเดตตัวเลือกใน select สำหรับการเลือกตาราง
            updateTableSelect();

            showStatusMessage(`ตาราง '${tableName}' ถูกเพิ่มแล้ว`);
          } else {
            showStatusMessage("การเพิ่มตารางถูกยกเลิก");
          }
        } else {
          showStatusMessage("กรุณากรอกชื่อของตาราง");
        }
      }

      function deleteTable() {
        const tableName = document.getElementById("tableDeleteSelect").value;
        if (tableName) {
          // ถามยืนยันจากผู้ใช้
          const confirmDelete = window.confirm(
            `คุณแน่ใจที่จะลบตาราง '${tableName}'?`
          );
          if (confirmDelete) {
            const table = document.getElementById(tableName);
            table.remove();

            // ลบตารางออกจาก localStorage
            let tables = JSON.parse(localStorage.getItem("tables")) || [];
            tables = tables.filter((name) => name !== tableName);
            localStorage.setItem("tables", JSON.stringify(tables));

            // ลบลิงก์ออกจาก localStorage
            let links = JSON.parse(localStorage.getItem("links")) || {};
            delete links[tableName];
            localStorage.setItem("links", JSON.stringify(links));

            updateTableSelect();

            showStatusMessage(`ตาราง '${tableName}' ถูกลบแล้ว`);
          } else {
            showStatusMessage("การลบตารางถูกยกเลิก");
          }
        } else {
          showStatusMessage("กรุณาเลือกตารางที่ต้องการลบ");
        }
      }

      // ฟังก์ชันสำหรับแสดงข้อความสถานะ
      function showStatusMessage(message) {
        const statusMessageDiv = document.getElementById("statusMessage");
        statusMessageDiv.textContent = message;
        statusMessageDiv.style.display = "block";

        setTimeout(() => {
          statusMessageDiv.style.display = "none";
        }, 5000);
      }
    </script>
  </body>
</html>
